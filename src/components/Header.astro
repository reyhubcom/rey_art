---
import Section from "../layouts/Section.astro";
import { MusicIcon, ShareIcon } from "../icons";
import SocialIcons from "./SocialIcons.astro";
import { Image } from 'astro:assets';

interface Props {
  name: string;
  description: string;
  bio: string;
  links?: Record<string, string>;
  picture: string;
}

const { name, bio, description, links = {}, picture }: Props = Astro.props;
---

<Section>
  <header class="py-2">
    <div class="relative mb-6">
      <Image
        src={picture}
        alt={name}
        loading="eager"
        class="w-32 h-32 rounded-full mx-auto border-2 border-white/20 shadow-2xl object-cover backdrop-blur-xl bg-white/5"
        height={128}
        width={128}
      />
      <div
        class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 bg-white/10 backdrop-blur-xl rounded-full p-2 border border-white/20"
      >
        <MusicIcon class="text-white size-5" />
      </div>
      <div class="absolute top-0 right-0 flex items-center justify-center bg-white/10 backdrop-blur-xl rounded-full p-2 border border-white/20 cursor-pointer hover:bg-white/20 transition-colors" id="share-button">
        <ShareIcon class="text-foreground" />
      </div>
    </div>
    <h1 class="text-3xl font-bold text-foreground mb-2">{name}</h1>
    <p class="text-foreground/80 text-lg">{description}</p>
    <p class="text-foreground/60 text-sm mt-2">
      {bio}
    </p>
    <div class="flex w-full items-start justify-center py-4 mt-4">
      <SocialIcons links={links} size={32} section="header" />
    </div>
  </header>
</Section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const shareButton = document.getElementById('share-button');
    
    if (shareButton) {
      shareButton.addEventListener('click', async () => {
        try {
          // Verificar si el navegador soporta Web Share API
          if (navigator.share && navigator.canShare) {
            const shareData = {
              title: document.title,
              text: 'Echa un vistazo a este perfil de artista',
              url: window.location.href
            };
            
            // Verificar si los datos son válidos para compartir
            if (navigator.canShare(shareData)) {
              await navigator.share(shareData);
              return;
            }
          }
          
          // Fallback: copiar al portapapeles
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(window.location.href);
          } else {
            // Fallback para contextos no seguros
            const textArea = document.createElement('textarea');
            textArea.value = window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
          }
          
          // Mostrar feedback visual temporal
          const originalContent = shareButton.innerHTML;
          shareButton.innerHTML = '<span class="text-green-400 text-sm">¡Copiado!</span>';
          setTimeout(() => {
            shareButton.innerHTML = originalContent;
          }, 2000);
          
        } catch (error) {
          if (typeof error === 'object' && error !== null && 'name' in error && (error as { name?: string }).name !== 'AbortError') {
            console.error('Error al compartir:', error);
            // Mostrar feedback de error
            const originalContent = shareButton.innerHTML;
            shareButton.innerHTML = '<span class="text-red-400 text-sm">Error</span>';
            setTimeout(() => {
              shareButton.innerHTML = originalContent;
            }, 2000);
          }
        }
      });
    }
  });
</script>
